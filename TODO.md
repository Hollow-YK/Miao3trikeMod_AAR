TODO 列表（Miao3trike 宏录制改造）
==============================

状态标记：☐ 未开始 / 🚧 进行中 / ✅ 完成 / ⚠️ 失败

1) 需求澄清与方案确认（宏触发与录制流程）
   - ✅ 确定功能开启后“录制一次拖动”的生命周期：由浮窗开关触发开始录制，录制结束立即执行宏，然后自动标记本轮完成并退出录制，等待用户下次手动开启浮窗开关以再次录制。
   - ✅ 确定录制触点来源：录制时在前台服务临时添加全屏透明 overlay（`TYPE_APPLICATION_OVERLAY`），独立于浮窗按钮，捕获用户一次拖动的 ACTION_DOWN/UP 坐标；录制完成后移除 overlay。

2) 坐标与适配策略
   - 🚧 依据 1920×1080 坐标点 TL(1718,18), TR(1851,18), BR(1883,143), BL(1744,143) 计算按钮中心的屏幕比例（16:9 通用），实现任意分辨率位置推算。
   - ☐ 明确比例计算后在宏执行时转换为实际坐标。

3) 宏执行管线设计
   - ☐ 设计手势执行顺序：点击按钮中心 → 10ms 延迟 → 拖动（录制起点→终点） → 10ms 延迟 → 全局返回。
   - ☐ 选择执行方式：无障碍 `GestureDescription` 序列化为一次提交或分步提交（考虑最小间隔与可靠性）。
   - ☐ 处理执行失败/权限缺失的兜底（日志/提示/忽略）。

4) 录制实现
   - ☐ 在无障碍服务中捕获用户下一次拖动：记录 ACTION_DOWN 坐标，追踪 MOVE，记录 ACTION_UP 终点，限制单次录制。
   - ☐ 防抖/过滤：忽略多指、超时或过短拖动的处理策略。

5) 状态机与交互
   - ☐ 将“功能开启”与“等待一次拖动录制”状态打通；录制完成后自动切回待命。
   - ☐ 浮窗点击行为保持：只切换功能开关，不影响录制逻辑。
   - ☐ UI 反馈（可选）：录制中/已捕获/执行中 的提示或图标。

6) 代码改造与文件范围
   - ☐ `FloatingWindowService`：保持拖拽/点击；如需状态提示或与无障碍通信则补接口。
   - ☐ `VolumeKeyAccessibilityService`：新增录制拖动与宏执行逻辑；原音量+双击返回逻辑将被替换/扩展。
   - ☐ 资源/配置：如需新增字符串/图标/权限提示时同步。

7) 测试与验证
   - ☐ 手动测试方案：授予权限 → 开启功能 → 触发单次拖动 → 验证宏顺序（点击→拖动→返回）与坐标正确性。
   - ☐ 自动化思路：Robolectric/Instrumentation 针对坐标换算与状态机的单元/集成测试。
